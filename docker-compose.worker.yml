# Worker node
# Run on 4 separate machines
# Set FAKTORY_SERVER_IP to your central server's IP address
services:
  worker-service:
    build:
      context: .
      dockerfile: Dockerfile.worker
    environment:
      - FAKTORY_URL=tcp://${FAKTORY_SERVER_IP:-localhost}:7419
      - RUST_LOG=warn
      # Very high concurrency to hide network fetch latency on remote workers
      # With 50ms network latency, need massive parallelism to saturate CPU
      # Increase this value until CPU maxes out or performance stops improving
      - WORKER_CONCURRENCY=${WORKER_CONCURRENCY:-2000}
    stop_grace_period: 35s
    deploy:
      resources:
        limits:
          cpus: "${WORKER_CPUS:-4.0}" # Configurable CPU limit, default 4 cores
